var AppCalendar = function() {
	var color = '';
	var flag = 0;
	return {
		init : function() {
			
			this.initCalendar()
			$('.color>li').on("click",function(){
				switch (flag){
				case 0:
					color = $(this).css("background-color");
					console.log(color);
					 $("#result").html(color);
					 console.log("first click");
		              
				 flag++;
				 break;
				 case 1:
					    color = '';
		                console.log("Seconde click");
						flag = 0;
				        break;
				}
			});
			 /*
				 * $('.color>li').on("click",function(){ console.log("inside
				 * colore function"); color = $(this).css("background-color");
				 * $("#result").html(color);
				 * 
				 * });
				 */
			
			$("#calendar").on("click",".fc-prev-button",function()				        
				       {  
				           console.log($("#calendar"));
				           console.log("prev button click function");
				           angular.element($(".fc-button-group")).scope().prevClick();
				      });
			$("#calendar").on("click",".fc-next-button",function()				        
				       {
				           console.log("next button click function");
				           angular.element($(".fc-button-group")).scope().nextClick();
				      });
		},
		initCalendar : function() {
			var locationArr = [];
			var locationsSetToCalendar = [];
			angular.element('.calendarCtrl').scope().getAllLocationDate();
			/*
			 * setTimeout(function() { locationsSetToCalendar =
			 * angular.element('.calendarCtrl').scope().list;
			 * console.log(locationsSetToCalendar, "dynamic");
			 * setTimeout(calenderList(), 10); }, 1000)
			 */ calenderList();

			function calenderList() {
				console.log("Inside Function()");
				if (jQuery().fullCalendar) {
					var e = new Date,
						t = e.getDate(),
						a = e.getMonth(),
						n = e.getFullYear(),
						r = {};
					App.isRTL() ? $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = {
						right : "title, prev, next",
						center : "",
						left : "agendaDay, agendaWeek, month, today"
					}) : ($("#calendar").removeClass("mobile"), r = {
						right : "title",
						center : "",
						left : "agendaDay, agendaWeek, month, today, prev,next"
					}) : $("#calendar").parents(".portlet").width() <= 720 ? ($("#calendar").addClass("mobile"), r = {
						left : "title, prev, next",
						center : "",
						right : "today,month,agendaWeek,agendaDay"
					}) : ($("#calendar").removeClass("mobile"), r = {
						left : "title",
						center : "",
						right : "prev,next,month"
					});
					var l = function(e) {
							var t = {
								title : $.trim(e.text())
							};
							e.data("eventObject", t), e.draggable({
								zIndex : 999,
								revert : !0,
								revertDuration : 0
							})
						},
						o = function(e) {
							e = 0 === e.length ? "Untitled Event" : e;
							var t = $('<div class="external-event label label-default">' + e + "</div>");
							jQuery("#event_box").append(t), l(t)
						};
					$("#external-events div.external-event").each(function() {
						l($(this))
					}), $("#event_add").unbind("click").click(function() {
						var e = $("#event_title").val();
						o(e)
					}),
					$("#event_box").html(""), o("My Event 1"), o("My Event 2"), o("My Event 3"), o("My Event 4"), o("My Event 5"), o("My Event 6"), $("#calendar").fullCalendar("destroy"), $("#calendar").fullCalendar({
						header : r,
						defaultView : "month",
						slotMinutes : 15,
						/*
						 * editable : !0, droppable : !0, drop : function(e, t) {
						 * var a = $(this).data("eventObject"), n = $.extend({},
						 * a); n.start = e, n.allDay = t, n.className =
						 * $(this).attr("data-class"),
						 * $("#calendar").fullCalendar("renderEvent", n, !0),
						 * $("#drop-remove").is(":checked") && $(this).remove() },
						 */
                        
						// events : locationsSetToCalendar,
					
						
						eventClick: function(date, event, view, calEvent) {
							var allEvents = [];
					    	var eventId = [];
					    	var eventIdZero = [];
					    	var d = moment(date.start._d).format("YYYY-MM-DD");
					    	console.log(color,"eventClick");
					    	if(color!=''){
					    	  var eventcss = $("td[data-date='" + d + "']").css('background-color',color);
					    	  $('.fc-day-number').removeAttr('style'); 
					    	    var bgColor= eventcss[0].style.backgroundColor;
						    	console.log(bgColor,e,"bgColor")
					            angular.element($("#calendar")).scope().dateClick(d, bgColor);	
					    	}
					    	else{
					    		 allEvents = $('#calendar').fullCalendar('clientEvents');
							    	console.log("Inside eventclick ---- ", allEvents, event);
							    	var dd = moment(date.start._d).format("YYYY-MM-DD");
							    	 var event = $.grep(allEvents, function (v) {
							    		 var vd = moment(v.start._d).format("YYYY-MM-DD");
							    		 console.log(v.start, date, vd, dd, "insideLoop");
							    		 if(vd == dd){
							    			 if(v._id > 0 && v._id != "null"){
							    				 eventId.push(v._id);	 
							    			 }
							    			 else {
							    				 if(v._id != "null"){
							    				 eventIdZero.push(v._id);
							    				 console.log("eventIdZero..........",eventIdZero,v._id);}
							    			 }
							    		 }
							         });
							    	console.log(eventId);
							    	if (eventId.length <= 0) {
							    		angular.element($(".fc-content")).scope().anyFunction(eventIdZero, dd);
								             console.log("booking id not found");	
							    	}  
								    else {
								    	
								     angular.element($(".fc-content")).scope().anyFunction(eventId, dd);
								     }
					    	}
					    	
					       
					    },
					    dayClick: function(date, jsEvent, view, allday) {
					    	var allEvents = [];
					    	var eventId = [];
					    	var eventIdZero = [];
					    	var d = moment(date).format("YYYY-MM-DD");
					    	console.log(color,"dayClick");
					    	if(color!=''){
					    		$(this).css('background-color', color);
						    	console.log($(this), "daycss");
						    	var bgColor= $(this)[0].style.backgroundColor;
					            angular.element($("#calendar")).scope().dateClick(d, bgColor);	
					    	}
					    	else{
					    		$(this).css('background-color', "");
					    		  allEvents = $('#calendar').fullCalendar('clientEvents');
							        console.log(allEvents,"allEvents");
							    	console.log("Inside dayClick ---- ", allEvents,date);
							    	var dd = moment(date._d).format("YYYY-MM-DD");
							    	 var event = $.grep(allEvents, function (v) {
							    		 var vd = moment(v.start._d).format("YYYY-MM-DD");
							    		 console.log(v.start, date);
							    		 if(vd == dd){
							    			 if(v._id > 0 && v._id != "null"){
							    				 eventId.push(v._id);	 
							    			 }else {
							    				 if(v._id != "null"){
								    				 eventIdZero.push(v._id);
								    				 console.log("eventIdZero..........",eventIdZero,v._id);}
								    			 }
							    		 }
							         });
							    	console.log(eventId);
							    	if (eventId.length <= 0) {
							    		angular.element($(".fc-content")).scope().anyFunction(eventIdZero, dd);
								             console.log("booking id not found");	
							    	}  
								    else {
								     angular.element($(".fc-content")).scope().anyFunction(eventId, dd);
								     }
					    	}
					    	
					      
				        },
				        eventRender: function (event, element, view) { 
					        var dateString = event.start.format("YYYY-MM-DD");
					        $(view.el[0]).find('.fc-day[data-date=' + dateString + ']').css('background-color', event.backgroundColor);
					       
				        
				        }
				            
				        	
					   })
				}
			}
		}
	}
}();
